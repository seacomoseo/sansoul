{{ $img := "" }}
{{ $svg := "" }}

{{ with .Params.image }}
  {{ if partial "functions/is-iframe" . }}
    {{ $img = partial "functions/iframe-poster" . }}
  {{ else }}
    {{ $img = . }}
  {{ end }}
{{ end }}

{{ if not $img }}
  {{ $img = partial "functions/logo" . }}
  {{ with $img }}
    {{ $img = strings.TrimPrefix . "/media/" }}
  {{ end }}
{{ end }}

{{ with $img }}
  {{ if not (hasPrefix . "http") }}
    {{ $path := print "/media/" . }}
    {{ with resources.Get $path }}

      {{ $img = .Permalink }}

      {{ if in $img ".svg" }}
        {{ $img  = .Permalink | replaceRE `\.svg$` `.png` }}
        {{ $png := resources.Get $img }}
        {{ with $png }}
          {{ $img = .Permalink }}
        {{ else }}
          {{ $svg = .RelPermalink }}
        {{ end }}
      {{ end }}

    {{ end }}
  {{ end }}
{{ end }}

{{ return (dict "img" $img "svg" $svg) }}