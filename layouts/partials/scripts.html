{{/*  LANGS  */}}

{{ $langs := dict }}
{{ range .AllTranslations }}
  {{ $t    := index site.Data.i18n .Lang }}
  {{ $lang := dict
    "lang"                   .Lang
    "disqusId"               (or site.Params.disqus "")
    "isGoogleTranslate"      (eq site.Params.google_translate true)
    "vid"                    $t.vid
    "loading"                $t.loading
    "mapTerrain"             $t.map_terrain
    "mapStreets"             $t.map_streets
    "mapSatellite"           $t.map_satellite
    "mapHybrid"              $t.map_hybrid
    "formGeo"                $t.form_geo
    "formErrorSingleQuotes"  $t.form_error_single_quotes
    "formErrorReqFields"     $t.form_error_req_fields
    "formErrorReqCheck"      $t.form_error_req_check
    "formErrorMail"          $t.form_error_mail
    "formErrorPhone"         $t.form_error_phone
    "formErrorFileSize"      $t.form_error_file_size
    "formErrorFileSizeTotal" $t.form_error_file_size_total
    "formErrorFileLength"    $t.form_error_file_length
    "formErrorFileOnload"    $t.form_error_file_onload
    "formErrorAcept"         $t.form_error_acept
    "formSubmitSending"      $t.form_submit_sending
    "formSubmitOk"           $t.form_submit_ok
    "formSubmitWrong"        $t.form_submit_wrong
  }}
  {{ $lang  = dict .Lang $lang }}
  {{ $langs = merge $langs $lang  }}
{{ end }}


{{/*  OPTIONS  */}}

{{ $opts := dict
  "minify"     hugo.IsProduction
  "targetPath" "js/scripts.js"
  "params"     (dict
    "draws"        (partial "func/draws-base" .)
    "cookiesLegal" (eq site.Data.config.cookies_legal true)
    "name"         site.Params.name
    "netlify"      (getenv "NETLIFY")
    "netlifyId"    site.Params.netlify_id
    "netlifyHook"  site.Params.netlify_hook
    "cloudflareId" site.Params.cloudflare_id
    "langs"        $langs
  )
}}


{{/*  MAYBE  */}}

{{ $is_scroll_show := false }}
{{ if site.Data.config.show }}
  {{ $is_scroll_show = true }}
{{ end }}

{{ $is_cookies := false }}
{{ if site.GetPage "page/cookies" }}
  {{ $is_cookies = true }}
{{ end }}

{{ $ga4_id := "" }}
{{ if hugo.IsProduction }}
  {{ with site.Params.ga4 }}
    {{ $ga4_id = . }}
  {{ end }}
{{ else }}
  {{ $ga4_id = "G-XXXXXXXXXX" }}
{{ end }}


{{/*  RESOURCES  */}}

{{ $_index := resources.Get "scripts.js" }}
{{ $custom := resources.Get "custom.js" }}

{{ $maybe_srcs := slice
  (dict "path" "scroll-show" "if" $is_scroll_show "func" "ScrollShow")
  (dict "path" "cookies"     "if" $is_cookies     "func" "Cookies"   )
  (dict "path" "ga4"         "if" $ga4_id         "func" "Ga4"       )
}}
{{ $conditional_srcs := slice }}
{{ range $maybe_srcs }}
  {{ $src  := "" }}
  {{ if .if }}
    {{ $src = print "import('./" .path "').then(m => m.init" .func "())" }}
  {{ end }}
  {{ $src   = $src | resources.FromString (print "aux_" .path ".js") }}
  {{ $conditional_srcs = $conditional_srcs | append $src }}
{{ end }}

{{ $js := slice $_index | append $conditional_srcs | append $custom | resources.Concat "js/scripts.js" }}
{{ $js  = $js | js.Build $opts }}

{{ if hugo.IsProduction }}
  {{ $js = $js | minify }}
{{ end }}
{{ $js = $js | fingerprint }}

{{ return $js }}
