{{- if ne .btn "hide" -}}
  {{- $sub := add ($.sub | default 0) 1 -}}
  {{- if eq .url "langs" -}}

    {{- range partial "menu/langs" . -}}
      {{- partial "menu/item" (merge . (dict
        "sub"        $sub
        "hide_icons" $.hide_icons
        "lock"       $.lock
      )) -}}
    {{- end -}}

  {{- else -}}

    {{- $item := . -}}
    {{- if eq .url "translate" -}}
      {{- $item = merge
        (dict
          "def"       "translate"
          "label"     (i18n "translate")
          "translate" true
        )
        .
        (dict "url" "")
      -}}
    {{- end -}}

    {{- with $item -}}
      {{- $hide_icons := $.hide_icons -}}
      {{- if .lang | or ((or .icon .def) | and (not .label)) -}}
        {{- $hide_icons = false -}}
      {{- end -}}
      {{- $icon   := cond (not $hide_icons) .icon    "" -}}
      {{- $def    := cond (not $hide_icons) .def "" -}}
      {{- $label  := .menu_label | default .label | markdownify -}}
      {{- $anchor := .anchor | default "auto" -}}

      {{- if or $label $icon $def -}}

        {{- $btn_class := slice
          (cond (not .btn)       "menu__link" "menu__btn")
          (cond (not .translate) "" "menu__link--translate")
          | append .class
        -}}

        {{- /*  li  */ -}}
        {{- $is_active := eq .url page.RelPermalink | and (not .IsHome) -}}
        {{- $li_class  := slice
          "menu__item"
          (cond $is_active "menu__item--active"   "")
          (cond .lang      "menu__item--lang"     "")
          (cond .items     "menu__item--subitems" "")
        -}}
        {{- $li_attrs := dict
          "class"    $li_class
          "lang"     .lang
          "title"    .title
          "tabindex" (cond .items "0" "")
          -}}
        {{- $li_attrs = partial "func/attrs" $li_attrs }}
        <li {{- $li_attrs }}>
          {{- /*  link  */}}
          {{ partial "link" (dict
            "class"  $btn_class
            "btn"    .btn
            "sm"     true
            "swap"   .swap
            "ga4"    .ga4
            "icon"   $icon
            "def"    $def
            "label"  $label
            "anchor" $anchor
            "url"    .url
            "lock"   .lock
          ) -}}

          {{- /*  subitems  */ -}}
          {{- with .items }}
            {{- $ul_class := print "menu__" (cond (eq $sub 0) "" "sub") "items" -}}
            <ul class="{{ $ul_class }}">
              {{- range . -}}
                {{- partial "menu/item" (merge . (dict
                  "sub"        $sub
                  "hide_icons" $.hide_icons
                )) -}}
              {{- end }}
            </ul>
          {{- end }}
        </li>
      {{- end -}}
    {{- end -}}

  {{- end -}}
{{- end -}}