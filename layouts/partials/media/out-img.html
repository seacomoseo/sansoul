{{- $vid_data := .vid | not | not -}}
{{- $vid_name := index .vid "name" | default "aux" -}}
{{- $vid_src  := index .vid "src" -}}

{{- $pic_attrs := dict
  "class"    .class
  $vid_name  $vid_data
  "data-vid" $vid_src
-}}
{{- $img_attrs := dict
  "src"      .img
  "alt"      .alt
  "decoding" "async"
  "loading"  .lazy
-}}
{{- $pic_attrs = partial "func/attrs" $pic_attrs -}}
{{- $img_attrs = partial "func/attrs" $img_attrs -}}

{{- /*  HTML  */}}
<picture {{- $pic_attrs }}><img {{- $img_attrs }}></picture>

{{- /*  icon  */ -}}
{{- with index .vid "play" }}
  {{ . -}}
{{- end -}}

{{- /*  schema  */}}
{{ if not .notschema -}}
  {{- with .vid -}}
    {{- partial "schema/vid" (dict
      "name"         $.alt
      "thumbnailUrl" $.img
      "uploadDate"   $.upload
      "duration"     $.duration
      "contentUrl"   .url
      "embedUrl"     .src
    ) -}}
  {{- else -}}
    {{- partial "schema/img" (dict
      "url"     .img
      "width"   512
      "height"  512
      "caption" .alt
    ) -}}
  {{- end -}}
{{- end -}}
