{{- $src := resources.Get .img -}}
{{- if $src -}}
  {{/*  get head, width and height  */}}
  {{- $head   := "" -}}
  {{- $width  := "" -}}
  {{- $height := "" -}}
  {{- with partial "func/svg-sizes" $src.Content -}}
    {{- $head   = .head   -}}
    {{- $width  = .width  -}}
    {{- $height = .height -}}
  {{- end -}}
  {{- if and $width $height | not -}}
    {{- $width  = 512 -}}
    {{- $height = 512 -}}
  {{- end -}}
  {{- if $head -}}
    {{- $iframe_data := .iframe | not | not -}}
    {{- $iframe_name := or .iframe.name "aux" -}}
    {{- $iframe_src  := cond $iframe_data .iframe.src false -}}
    {{- $attrs       := dict "data-iframe" $iframe_data $iframe_name $iframe_src -}}
    {{- $min         := $src | minify -}}
    {{- $content     := $min.Content | replaceRE `\n` "" -}}
    {{- $src          = $content | resources.FromString $src.RelPermalink -}}
    {{/*  print  */}}
    {{- if $content | findRE `svg-src` -}}
      {{/*  image tag  */}}
      {{- $img_attrs := dict
        "class"    .class
        "src"      $src.RelPermalink
        "alt"      .alt
        "width"    $width
        "height"   $height
        "decoding" "async"
        "loading"  .lazy
      -}}
      {{- $img_attrs = merge $attrs $img_attrs -}}
      {{- $img_attrs = partial "func/attrs" $img_attrs }}
      <img {{- $img_attrs }}>
    {{- else if $content | findRE `svg-html` -}}
      {{/*  svg html  */}}
      {{- $attrs   = partial "func/attrs" $attrs -}}
      {{- $content = replace $content "<svg" (print "<svg" $attrs) -}}
      {{- if not ($head | findRE ` width=`) -}}
        {{- $content = replace $content "<svg" (print "<svg width='" $width "'") -}}
      {{- end -}}
      {{- if not ($head | findRE ` height=`) -}}
        {{- $content = replace $content "<svg" (print "<svg height='" $height "'") -}}
      {{- end -}}
      {{- if .class -}}
        {{- $content = replace $content "<svg" (print "<svg class='" .class "'") -}}
      {{- end -}}
      {{- $content | safeHTML -}}
    {{- else -}}
      {{/*  svg sprite  */}}
      {{- $sprit := dict "class" .class "width" $width "height" $height "aria-label" .alt -}}
      {{- $attrs  = merge $attrs $sprit -}}
      {{- $attrs  = partial "func/attrs" $attrs -}}
      {{- $draws := partial "func/draws-base" . -}}
      {{- $id    := .img | replaceRE `^/u/(icons?/)?|.svg$` "" | replaceRE `^(brand)s/` `$1-` | replaceRE `/` "-" -}}
      {{- $href  := print $draws "#" $id }}
      <svg {{- $attrs }}><use href="{{ $href }}"></use></svg>
    {{- end -}}

    {{- /*  ICON PLAY  */ -}}
    {{- with .iframe.play }}
      {{ . -}}
    {{- end -}}


    {{- /*  schema  */}}
    {{ if not .notschema -}}
      {{- partial "schema/img" (dict
        "url"     $src.Permalink
        "width"   $width
        "height"  $height
        "caption" .alt
      ) -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
