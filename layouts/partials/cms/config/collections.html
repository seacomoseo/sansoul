{{ $t := partial "functions/i18n" . }}

{{ $colections := slice }}

{{/*  CUSTOM TYPES  */}}
{{ range site.Sections }}

  {{/*  Slug  */}}
  {{ $slug  := "{{fields.slug}}" }}
  {{ if in (slice "article" "event") .Params.base }}
    {{ $slug = "{{year}}-{{month}}-{{day}}-{{fields.slug}}" }}
  {{ end }}

  {{/*  Permalinks  */}}
  {{ $permalinks    := "{{fields.slug}}" }}
  {{ with .Params.cms.permalinks }} 
    {{ $permalinks   = print . "/{{fields.slug}}" }}
    {{ if in . ":" }}
      {{ $permalinks = $permalinks | replaceRE `:(year|month|day)` "{{$1}}" }}
    {{ end }}
  {{ end }}
  {{ $permalinks     = print site.Home $permalinks }}

  {{/*  Summary  */}}
  {{ $summary  := "{{title}}" }}
  {{ if in (slice "article" "event") .Params.base }}
    {{ $summary = "üìÖ {{date | date('yyyy-MM-dd')}} üïí {{date | date('HH:mm')}} ‚û°Ô∏è {{title}}" }}
  {{ end }}

  {{/*  Sortable Fields  */}}
  {{ $sortable_fields    := slice "commit_date" "title" }}
  {{ if eq .Params.base "article" }}
    {{ $sortable_fields   = slice "date" "lastmod" | append $sortable_fields }}
  {{ end }}
  {{ if eq .Params.base "event" }}
    {{ $sortable_fields   = slice "date" "end"     | append $sortable_fields }}
  {{ end }}
  {{ with .Params.custom_params }}
    {{ range where . "type" "date" }}
      {{ $sortable_fields = $sortable_fields       | append .name }}
    {{ end }}
  {{ end }}
  {{ with .Params.relations_from }}
    {{ range . }}
      {{ $sortable_fields = $sortable_fields       | append .name }}
    {{ end }}
  {{ end }}

  {{/*  Groups  */}}
  {{ $groups  := slice }}
  {{ if in (slice "article" "event") .Params.base }}
    {{ $groups = $groups | append
      (dict "name" `year`    "label" $t.filter_year   "field" `date` "pattern" `^\d{4}`)
      (dict "name" `month`   "label" $t.filter_month  "field" `date` "pattern" `^\d{4}-\d{2}`)
    }}
  {{ end }}
  {{ $groups = $groups | append
    (dict   "name" `noindex` "label" `NoIndex`        "field" `noindex`)
    (dict   "name" `drafts`  "label" $t.filter_drafts "field" `draft`)
  }}
  {{ with .Params.relations_from }}
    {{ range . }}
      {{ $label := (site.GetPage .name).Params.cms.title }}
      {{ $groups = $groups | append
        (dict "name" .name   "label" $label           "field" .name)
      }}
    {{ end }}
  {{ end }}

  {{/*  Fields  */}}
  {{ $fields  := slice
    `~P_TITLE`
    `~P_TITLE_SEO`
    `~P_SLUG`
    `~P_DESCRIPTION`
    `~P_IMAGE`
  }}
  {{ if eq .Params.base "article" }}
    {{ $fields = $fields | append
      `~P_DATE`
      `~P_LASTMOD`
    }}
  {{ else if eq .Params.base "product" }}
    {{ $fields = $fields | append
      `~P_SKU`
      `~P_PRICE`
    }}
  {{ else if eq .Params.base "event" }}
    {{ $fields = $fields | append
      `~P_DATE`
      `~P_END`
      `~P_ARTISTS`
      `~P_LOCATION`
      `~P_PLACE`
      `~P_PRICE`
    }}
  {{ else if eq .Params.base "author" }}
    {{ $fields = $fields | append
      `~P_JOB_TITLE`
      `~SCHEMA_SOCIAL`
    }}
  {{ else if eq .Params.base "organization" }}
    {{ $fields = $fields | append
      `~SCHEMA_TYPES`
      `~SCHEMA_NAMES`
      `~SCHEMA_LEGAL`
      `~SCHEMA_NIF`
      `~SCHEMA_LOGO`
      `~SCHEMA_IMAGES`
      `~SCHEMA_SOCIAL`
      `~SCHEMA_PHONES`
      `~SCHEMA_ADDRESS`
      `~SCHEMA_AREAS`
      `~SCHEMA_OPEN`
      `~SCHEMA_PRICES`
      `~SCHEMA_SERVICES`
      `~SCHEMA_FOOD_MENU`
      `~SCHEMA_FOOD_TYPE`
    }}
  {{ else if eq .Params.base "service" }}
    {{ $fields = $fields | append
      `~SCHEMA_AREAS`
      `~P_SERVICE_TYPES`
      `~P_PRICE`
    }}
  {{ end }}
  {{ range (.Params.custom_params | default slice) | append (.Params.relations_from | default slice) }}
    {{ $type        := .type | default "relation" }}
    {{ $value_type  := "" }}
    {{ if in (slice "int" "float") .type }}
      {{ $type       = "number" }}
      {{ $value_type = .type }}
    {{ end }}
    {{ $i18n  := "duplicate" }}
    {{ if in (slice "string" "text" "markdown" "image") .type }}
      {{ $i18n = true }}
    {{ end }}
    {{ $lang   := index . $.Lang }}
    {{ $label  := $lang.label | default .name }}
    {{ $hint   := $lang.hint }}
    {{ if not .type }}
      {{ $label = (site.GetPage .name).Params.cms.title }}
      {{ $hint  = print "[" $t.types_customs_params_relations_hint "](#/collections/" .name ")" }}
    {{ end }}

    {{ $fields = $fields | append
      (dict
        "name"           .name
        "widget"         $type
        "i18n"           $i18n
        "required"       false
        "label"          $label
        "hint"           $hint
        "options"        .options
        "options_length" 100
        "collection"     .name
        "value_field"    "{{slug}}"
        "search_fields"  (slice "{{title}}")
        "display_fields" (slice "{{title}}")
        "multiple"       .multiple
        "choose_url"     true
        "max_file_size"  512000000
        "value_type"     $value_type
        "format"         `yyyy-MM-dd HH:mm:ss`
        "date_format"    `yyyy-MM-dd`
        "time_format"    `HH:mm`
      )
    }}
  {{ end }}
  {{ $fields = $fields | append
    `~P_TOC`
    `~P_DRAFT`
    `~P_NOINDEX`
    `~P_TRANSLATIONKEY`
    `~P_BODY`
  }}

  {{/*  Collection  */}}
  {{ $colections = $colections | append (dict
    "label"            .Params.cms.title
    "label_singular"   .Params.cms.singular
    "name"             .Type
    "description"      .Params.cms.hint
    "identifier_field" `slug`
    "folder"           (print `content.` .Lang `/` .Type)
    "create"           true
    "slug"             $slug
    "preview_path"     $permalinks
    "summary"          $summary
    "editor"           (dict "preview" false)
    "sortable_fields"  (dict "fields"  $sortable_fields)
    "view_groups"      (dict "groups"  $groups)
    "view_filters"     (dict
      "filters" (slice
        (dict "name" `published` "label" $t.filter_published "field" `draft`   "pattern" false)
        (dict "name" `drafts`    "label" $t.filter_drafts    "field" `draft`   "pattern" true)
        (dict "name" `index`     "label" `Index`             "field" `noindex` "pattern" false)
        (dict "name" `noindex`   "label" `NoIndex`           "field" `noindex` "pattern" true)
      )
    )
    "fields"           $fields
  ) }}
{{ end }}


{{/*  ROOT PAGES  */}}
{{ $colections = $colections | append (dict
  "label"            $t.collection_page
  "label_singular"   $t.collection_page_singular
  "name"             `page`
  "description"      $t.collection_page_description
  "identifier_field" `slug`
  "folder"            (print `content.` .Lang)
  "create"            true
  "slug"             "{{fields.slug}}"
  "preview_path"      (print site.Home.RelPermalink "{{fields.slug}}/")
  "summary"           "{{title}}"
  "sortable_fields"   (dict "fields" (slice "commit_date" "title"))
  "view_filters"      (dict
    "filters" (slice
      (dict "name" `published` "label" $t.filter_published "field" `draft`   "pattern" false)
      (dict "name" `drafts`    "label" $t.filter_drafts    "field" `draft`   "pattern" true)
      (dict "name" `index`     "label" `Index`             "field" `noindex` "pattern" false)
      (dict "name" `noindex`   "label" `NoIndex`           "field" `noindex` "pattern" true)
    )
  )
  "view_groups"       (dict
    "groups" (slice
      (dict "name" `year`      "label" $t.filter_year         "field" `date` "pattern" `^\d{4}`)
      (dict "name" `month`     "label" $t.filter_month        "field" `date` "pattern" `^\d{4}-\d{2}`)
      (dict "name" `noindex`   "label" `NoIndex`              "field" `noindex`)
      (dict "name" `drafts`    "label" $t.filter_drafts       "field" `draft`)
    )
  )
  "editor"            (dict "preview" false )
  "fields"            (slice
    `~P_TITLE`
    `~P_TITLE_SEO`
    `~P_SLUG`
    `~P_DESCRIPTION`
    `~P_IMAGE`
    `~P_DRAFT`
    `~P_NOINDEX`
    `~P_TRANSLATIONKEY`
    `~TEMPLATE_BACKGROUND`
    `~TEMPLATE_MENU_SINGLE`
    `~TEMPLATE_CALLNOW_SINGLE`
    `~TEMPLATE_SECTION`
    `~TEMPLATE_MODAL`
    `~TEMPLATE_SECTIONS`
    `~P_BASE`
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" (slice `article` `event`))) `~P_DATE`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `article`     )) `~P_LASTMOD`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `event`       )) `~P_END`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `event`       )) `~P_ARTISTS`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `event`       )) `~P_LOCATION`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `event`       )) `~P_PLACE`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `product`     )) `~P_SKU`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `author`      )) `~P_JOB_TITLE`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_TYPES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_NAMES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_LEGAL`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_NIF`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_LOGO`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_IMAGES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" (slice `organization` `author`))) `~SCHEMA_SOCIAL`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_PHONES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_ADDRESS`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" (slice `organization` `service`))) `~SCHEMA_AREAS`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_OPEN`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_PRICES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_SERVICES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_FOOD_MENU`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `organization`)) `~SCHEMA_FOOD_TYPE`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" `service`     )) `~P_SERVICE_TYPES`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" (slice `event` `product` `service`))) `~P_PRICE`))
    (dict "<<" (slice (dict "condition" (dict "field" `base` "value" (slice `article` `event` `product` `service` `brand` `author` `organization` `service` `page`))) `~P_BODY`))
  )
) }}


{{/*  SECTIONS  */}}
{{ $colections = $colections | append (dict
  "label"            $t.collection_sections
  "label_singular"   $t.collection_sections_singular
  "name"             `section`
  "description"      $t.collection_sections_description
  "identifier_field" `name`
  "extension"        `yml`
  "folder"           (print `content.` .Lang `/section`)
  "create"           true
  "nested"           (dict "depth" 5)
  "slug"             "{{fields.name}}"
  "summary"          "{{dirname | upper}}{{dirname | ternary(' ‚û°Ô∏è ','')}}{{name}}"
  "sortable_fields"  (dict "fields" (slice "commit_date" "name" "id"))
  "editor"           (dict "preview" false)
  "fields"           `~SECTIONS_FIELDS`
) }}


{{/*  MODALS  */}}
{{ $colections = $colections | append (dict
  "label"            $t.collection_modals
  "label_singular"   $t.collection_modals_singular
  "name"             `modal`
  "description"      $t.collection_modals_description
  "identifier_field" `name`
  "extension"        `yml`
  "folder"           (print `content.` .Lang `/modal`)
  "create"           true
  "nested"           (dict "depth" 5)
  "slug"             "{{fields.name}}"
  "summary"          "{{dirname | upper}}{{dirname | ternary(' ‚û°Ô∏è ','')}}{{name}}"
  "sortable_fields"  (dict "fields" (slice "commit_date" "name" "id"))
  "editor"           (dict "preview" false)
  "fields"           `~MODALS_FIELDS`
) }}


{{/*  SETTINGS  */}}
{{ $colections = $colections | append  (dict
  "label"           $t.collection_settings
  "name"            `settings`
  "sortable_fields" (dict "fields" slice)
  "editor"          (dict "preview" false)
  "files"           (slice
    (dict "file" `data/config.yml`     "extension" `yml` "name" `config`    "label" $t.config    "fields" `~SETTINGS_CONFIG`)
    (dict "file" `data/types.yml`      "extension" `yml` "name" `types`     "label" $t.types     "fields" `~SETTINGS_TYPES`)
    (dict "file" `data/schema.yml`     "extension" `yml` "name" `schema`    "label" $t.schema    "fields" `~SETTINGS_SCHEMA`)
    (dict "file" `data/styles.yml`     "extension" `yml` "name" `styles`    "label" $t.styles    "fields" `~SETTINGS_STYLES`)
    (dict "file" `data/remote.yml`     "extension" `yml` "name" `remote`    "label" $t.remote    "fields" `~SETTINGS_REMOTE`)
    (dict "file" `assets/redirects.md` "extension" `md`  "name" `redirects` "label" $t.redirects "fields" (slice (dict "name" `body` "widget" `text` "required" false "label" $t.redirects "hint" $t.redirects_hint)))
    (dict "file" `assets/robots.md`    "extension" `md`  "name" `robots`    "label" `Robots.txt` "fields" (slice (dict "name" `body` "widget" `text` "required" false "label" `robots.txt` "hint" $t.robots_hint)))
  )
) }}

{{ return $colections }}