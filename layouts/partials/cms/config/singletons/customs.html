{{ $u := site.Data.utilities }}

{{ $option_global         := index . "option-collections-global" }}
{{ $customs_types_default := print $u.defaults.values.emoji  " " $option_global }}
{{ $customs_types_hint    := print .default " â†’ **" $customs_types_default "**" }}

{{ $widgets_last := apply $u.widgets "dict" "value" "." }}
{{ $widgets_last  = where $widgets_last "value" "not in" (slice "object" "list") }}
{{ $widgets_last  = apply $widgets_last "index" "." "value" }}

{{ $sub_fields := slice
  `~customs_var`
  `~customs_name`
  `~customs_label`
  `~customs_hint_`
  `~customs_widget`
  `~customs_options`
  `~customs_multiple`
}}
{{ $sub_fields_last := slice
  `~customs_var`
  `~customs_name`
  `~customs_label`
  `~customs_hint_`
  `~customs_widget_last`
  `~customs_options`
  `~customs_multiple`
}}

{{ return slice

  (partial "cms/widget" (dict "var" `customs_types`    "name" `types`    "widget" `select`  "options" `~options_customs` "multiple" true "hint" $customs_types_hint))
  (partial "cms/widget" (dict
    "var"    `customs_pages`
    "name"   `pages`
    "widget" `list`
    "field"  (partial "cms/widget" (dict "label" .customs_pages_singular "name" `page`))
  ))
  (partial "cms/widget" (dict "var" `customs_var`      "name" `var`                                             ))
  (partial "cms/widget" (dict "var" `customs_name`     "name" `name`                                            ))
  (partial "cms/widget" (dict "var" `customs_label`    "name" `label`                                           ))
  (partial "cms/widget" (dict "var" `customs_hint_`    "name" `hint`                                            ))
  (partial "cms/widget" (dict "var" `customs_widget`   "name" `widget`   "widget" `select`  "options" $u.widgets))
  (partial "cms/widget" (dict "var" `customs_multiple` "name" `multiple` "widget" `boolean`                     ))
  (partial "cms/widget" (dict
    "var"    `customs_options`
    "name"   `options`
    "widget" `list`
    "fields" (slice
      (partial "cms/widget" (dict "alt" `customs_options_label` "name" `label`))
      (partial "cms/widget" (dict "alt" `customs_options_value` "name" `value`))
    )
  ))

  (partial "cms/widget" (dict "var" `customs_widget_last` "<<" `customs_widget` "options" $widgets_last))
  (partial "cms/widget" (dict
    "var"    `customs_last`
    "alt"    `customs_sub`
    "name"   `sub`
    "widget" `list`
    "fields" $sub_fields_last
  ))
  (partial "cms/widget" (dict "var" `customs_3` "<<" `customs_last` "fields" ($sub_fields | append `~customs_last`)))
  (partial "cms/widget" (dict "var" `customs_2` "<<" `customs_3`    "fields" ($sub_fields | append `~customs_3`   )))
  (partial "cms/widget" (dict "var" `customs_1` "<<" `customs_2`    "fields" ($sub_fields | append `~customs_2`   )))

  (dict "&customs" (slice
    (partial "cms/widget" (dict
      "alt"    `customs`
      "<<"     `customs_1`
      "root"   true
      "fields" (slice
        `~customs_types`
        `~customs_pages`
        | append $sub_fields
        | append `~customs_1`
      )
    ))
  ))
}}