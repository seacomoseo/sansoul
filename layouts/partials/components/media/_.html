{{- if .src -}}
  {{- $media := . -}}
  {{- $src   := .src -}}
  {{- $mute  := cond (in $src "#mute") true .bg -}}
  {{- if not $mute -}}
    {{- if partial "functions/is-iframe" $src -}}
      {{- $iframe    := partial "functions/iframe-src" (dict "src" $src "bg" .bg) -}}
      {{- $src        = partial "functions/iframe-poster" .src -}}
      {{- $color     := cond (or (not .icon_color) (eq .icon_color "cta")) "" .icon_color -}}
      {{- $icon      := site.Data.styles.icons.play | default "play-iframe" -}}
      {{- $icon_play := partial "components/icon" (dict "class" $color "icon" $icon "emoji" "▶️") -}}
      {{- $media      = merge $media (dict
        "iframe"    $iframe
        "src"       $src
        "icon_play" $icon_play
      ) -}}
    {{- end -}}
  {{- end -}}
  {{- $media = merge $media (dict "mute" $mute) -}}

  {{- if hasPrefix $src "http" -}}
    {{- if $src | findRE `\.(mp4|mov|avi|webm)` -}}
      {{- partial "components/media/external/video" . -}}
    {{- else if $src | findRE `youtu\.be|youtube\.com` -}}
      {{- partial "components/media/external/youtube" . -}}
    {{- else if and (in $src "vimeo.com") (not (in $src "/api/v2/")) -}}
      {{- partial "components/media/external/vimeo" . -}}
    {{- else -}}
      {{- partial "components/media/external/image" $media -}}
    {{- end -}}
  {{- else -}}
    {{- $src   = print "/media/" $src -}}
    {{- $media = merge $media (dict "src" $src) -}}
    {{- if $src | findRE `\.(mp4|mov|avi|webm)` -}}
      {{- partial "components/media/internal/video" $media -}}
    {{- else if in $src ".svg" -}}
      {{- partial "components/media/internal/svg" $media -}}
    {{- else -}}
      {{- partial "components/media/internal/image" $media -}}
    {{- end -}}
  {{- end -}}
{{- end -}}