{{- /*  Basic booleans  */ -}}
{{- $header := eq .id "header" -}}
{{- $footer := eq .id "footer" -}}
{{- $modal  := .modal | default false -}}

{{- /*  Node  */ -}}
{{- $node := .node -}}
{{- if $modal -}}
  {{- $node = "dialog" -}}
{{- end -}}
{{- if not $node -}}
  {{- if $header -}}
    {{- $node = "header" -}}
  {{- else if $footer -}}
    {{- $node = "footer" -}}
  {{- else -}}
    {{- $node = "section" -}}
  {{- end -}}
{{- end -}}

{{- /*  is_bg and color  */ -}}
{{- $color := cond $modal "black" .color -}}
{{- $is_bg := or .bg $color .fade -}}
{{- /*  Add similar color if...  */ -}}
{{- $types := or .geos .images .limages -}}
{{- $add   := and $types .ph (not $is_bg) -}}
{{- $color  = cond $add "similar" $color -}}
{{- /*  Change color if is similar or invert and set bgcp  */ -}}
{{- $bgc_o := dict "child" $color "parent" .bgcp -}}
{{- $bgc   := partial "functions/color-background" $bgc_o -}}
{{- $bgcp  := $bgc.parent -}}
{{- $color  = $bgc.child -}}

{{- /*  Container size  */ -}}
{{- $container := .size -}}
{{- if not $container -}}
  {{- if .ph -}}
    {{- $container = "fluid" -}}
  {{- else if $modal -}}
    {{- $container = "sm" -}}
  {{- else -}}
    {{- $container = "lg" -}}
  {{- end -}}
{{- end -}}

{{- /*  Attributes  */ -}}
{{- $attr_opts := dict
  "color"  $color
  "header" $header
  "footer" $footer
  "modal"  $modal
-}}
{{- $attr_opts = merge . $attr_opts -}}
{{- $attr := partial "components/base/sections/attr" $attr_opts -}}

{{- /*  SECTION  */}}
{{ print "<" $node $attr ">" | safeHTML -}}

  {{- /*  BACKGROUND  */ -}}
  {{- if not $modal -}}
    {{- $back_opts := dict
        "is_bg"     $is_bg
        "color"     $color
        "card"      nil
        "container" "fluid"
    -}}
    {{- $back_opts  = merge . $back_opts -}}
    {{- partial "components/bg" $back_opts -}}
  {{- end -}}

  {{- /*  IMAGE LCP  */ -}}
  {{- if $header }}
    <div class="lcp">‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà</div>
  {{- end -}}

  {{- /*  BOX  */ -}}
  {{- $box_opts := dict
    "main"        true
    "deep"        0
    "level"       (cond $header 1 (cond $modal 3 2))
    "header"      $header
    "footer"      $footer
    "modal"       $modal
    "bgcp"        $bgcp
    "node"        (cond $modal .node        .box_node)
    "bg"          (cond $modal .bg          .box_bg)
    "alpha"       (cond $modal .alpha       .box_alpha)
    "parallax"    (cond $modal .parallax    .box_parallax)
    "color"       (cond $modal .color       .box_color)
    "color_alpha" (cond $modal .color_alpha .box_color_alpha)
    "fade"        (cond $modal .fade        .box_fade)
    "fade_type"   (cond $modal .fade_type   .box_fade_type)
    "image_align" nil
    "full"        nil
    "pt"          nil
    "pb"          nil
    "div"         nil
    "div_x"       nil
    "div_y"       nil
    "id"          nil
    "if"          nil
    "container"   $container
    "col_vl"      1.00
    "col_vs"      1.00
    "section"     .
    "box_wrap"    true
    "parent"      .box
  -}}
  {{- $box_opts  = merge . $box_opts -}}
  {{- partial "components/boxes/box" $box_opts -}}

  {{- /*  MODAL BUTTONS CORNER  */ -}}
  {{- if $modal  -}}
    {{- /*
    {{- partial "components/link" (dict
      "class"  "modal__back"
      "button" "cta"
      "dot"    true
      "icon"   (site.Data.styles.icons.left | default "arrow-left")
      "emoji"  "‚¨ÖÔ∏è"
      "label"  (i18n "back")
    ) -}}
    */}}
    {{ partial "components/link" (dict
      "class"  "modal__close--corner"
      "button" "cta"
      "dot"    true
      "icon"   "xmark"
      "emoji"  "‚ùå"
      "label"  (i18n "close")
    ) -}}
  {{- end -}}

  {{- /*  COOKIES AND SITEMAP LINK  */ -}}
  {{- if $footer }}
    <div class="footer__float">
      {{ partial "components/link" (dict
        "class"  "cookies__toggle"
        "icon"   "cookie-bite"
        "emoji"  "üç™"
        "title"  (i18n "cookies_notice")
        "lock"   true
      ) }}
      {{ with site.GetPage "page/sitemap" -}}
        {{- partial "components/link" (dict
          "class"  "footer__sitemap"
          "icon"   "sitemap"
          "emoji"  "üó∫"
          "title"  .Title
          "link"   .RelPermalink
          "lock"   (not page.IsHome)
        ) -}}
      {{- end }}
    </div>
  {{- end }}
{{ print "</" $node ">" | safeHTML -}}
