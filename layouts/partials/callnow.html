{{- if and . (ne . "none") -}}

  {{- $btns := slice -}}

  {{- if eq . "custom" -}}
  
    {{- $values := index site.Data (print "values." page.Lang) -}}
    {{- $items  := $values.callnows -}}
    {{- with $items -}}
      {{- range . -}}
        {{- $btns = $btns | append . -}}
      {{- end -}}
    {{- end -}}

  {{- else if eq . "auto" -}}

    {{- /*  Get link phones from page store  */ -}}
    {{- $phones := page.Store.Get "phones" -}}
    {{- with $phones -}}
      {{- with where . "type" "whatsapp" -}}
        {{- $btns   = first 1 . -}}
      {{- else -}}
        {{- with where . "type" "phone" -}}
          {{- $btns = first 1 . -}}
        {{- else -}}
          {{- $btns = first 1 . -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

  {{- end -}}

  {{- with $btns -}}
    {{- $callnow_plus := cond (eq (len .) 1) "" "callnow--plus" }}
    <aside id="callnow" class="callnow {{ $callnow_plus }}">
      {{- range . -}}

        {{- $class   := "" -}}
        {{- $num     := "" -}}
        {{- $url     := .url -}}
        {{- $btn     := .btn | default "cta" -}}
        {{- $icon    := .icon -}}
        {{- $def     := "" -}}
        {{- $label   := .label -}}
        {{- $anchor  := .anchor | default "auto" -}}
        {{- $noindex := .lock -}}

        {{- if in (slice "phone" "whatsapp") .type -}}
          {{- $num   = partial "func/phone-to-complete" .label | replaceRE `[^\d]` "" -}}
        {{- end -}}

        {{- if eq .type "custom" -}}
          {{- $class   = "callnow__custom" -}}
        {{- else if eq .type "phone" -}}
          {{- $class   = "callnow__phone" -}}
          {{- $url     = print "tel:+" $num -}}
          {{- $def     = "phone" -}}
          {{- $label   = i18n "callnow_phone" -}}
          {{- $noindex = true -}}
        {{- else if eq .type "whatsapp" -}}
          {{- $class   = "callnow__whatsapp" -}}
          {{- $url     = print "https://wa.me/" $num -}}
          {{- $btn     = cond (not .btn) "whatsapp" $btn -}}
          {{- $def     = "whatsapp" -}}
          {{- $label   = i18n "callnow_whatsapp" -}}
          {{- $noindex = true -}}
        {{- end -}}

        {{- if $callnow_plus -}}<i>{{- end -}}

        {{- with $label }}
          <div class="callnow__caption">{{ . }}</div>
        {{- end -}}

        {{- partial "link" (dict
          "class"  $class
          "btn"    $btn
          "dot"    true
          "swap"   true
          "ga4"    .ga4
          "icon"   $icon
          "def"    $def
          "label"  $label
          "anchor" $anchor
          "url"    $url
          "lock"   $noindex
        ) -}}

        {{- if $callnow_plus -}}</i>{{- end -}}

      {{- end -}}
    </aside>
  {{- end -}}

{{- end -}}